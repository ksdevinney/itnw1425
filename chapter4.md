# Network Protocols and Routing

Headers and trailers through the layers:
* 7, 6, 5: Payload (data and instructions) generated by an application on the source host (ex the browser)
* 4: transport layer protocol adds a header to the payload, including a port number for the receiving host, whole thing becomes a segment (TCP) or datagram (UDP)
* 3: network layer adds a header to identify the IP address of the destination (whole thing is a packet)
* 2: packet is passed to the data link layer on the NIC, which adds a header and trailer, including a phyical address for finding the node on the network (whole thing is a frame)
* 1: physical layer, NIC receives the frame and places the transmission on the network

Receiving host then goes through this process in reverse order and presents the payload to the receving application

## Network Protocols

### Transmission Control Protocol

*transport layer*

TCP operates on the transport layer and provides reliable data delivery services

Header has 10 fields

TCP characteristics:
* connection-oriented: ensures a connection is established before transmitting data
* sequencing and checksums: TCP sends a test string (checksum) and destination host generates a similar string; checksums must match or the destination host asks source to retransmit the data
* flow control: gauging the appropriate rate of transmission based on how quickly the recipient can receive data

Three-way handshake: establishes a session before TCP transmits actual data
1. SYN: request for a connection; host sends a checksum, SYN flag is activated
2. SYN/ACK: response to the request; ACK and SYN flags activated, ACK sends a number equal to the checksum + 1, recipient sends its own random number
3. ACK: connection established; host issues a segment with the number recipient expects to receive, acknowledgement field set to number recipient sent + 1, ACK flag activated

Payload is sent after this process; can be done in one or more messages, depending on data size
Sequence numbers will increase by amount of bits included in each received segment

Two hosts communicate until original host activated FIN flag

### User Datagram Protocol

*transport layer*

Unreliable (doesn't guarantee delivery of data) and connectionless

More efficient and faster than TCP because it does not establish a connection; useful for live audio and video transmissions, and when speed is more important than accuracy

Header has 4 fields

## Internet Protocol

*network layer* 

Specifies where data should be delivered

Does not create a session to deliver its packets, packets travel separately and may take different routes. Once messages are delivered, TCP is responsible for putting messages back in the correct order, TCP/UDP also responsible for making sure data reaches the correct application

IPv4 is standard, but IPv6 is more secure; many organizations have not upgraded to IPv6 because of structural upgrades required

IPv4 and IPv6 have different header arrangements; both begin with a version
IPv6 packets accommodate larger IP addresses, no fragment offset fields; IPv6 adjusts packet sizes to fit the network

### Internet Control Message Panel

*network layer*

Reports on the success or failure of a delivery; announces transmission failures to the sender but does not attempt to correct errors

ICMP messages contain an ICMP header and an IP header: ICMP header contains type, code, checksum, rest of header

### Address Resolution Protocol

*data link layer*

Works with IPv4 to discover the MAC address of a node on the network, maintains a database connecting local IP addresses to MAC addresses

Relies on broadcasting, which transmits to all nodes on a network

ARP table: database of IP-to-MAC mapping
Entries can be static or dynamic: static (has been entered manually), dynamic (created when a client makes a request for data not already in the table)

### Ethernet

*data link layer*

Most popular network technology used on modern LANs

Adds both a header and a trailer to the payload it inherits from the layer above
Preamble and SFD are removed from incoming transmissions befre it becomes visible

MTU: maximum transmission unit, largest size (in bytes) routers in a network's path will allow at the network layer
Default for Ethernet is 1500 bytes

Maximum size of an IP packet is larger than Ethernet MTU- large packets are divided into smaller packets via fragmentation

## Routers

Routers join two or more networks and pass packets between them

All routers can:
* connect dissimilar networks (LAN and WAN)
* interpret layer 3 and layer 4 addressing
* determine the most efficient path for data to take
* reroute traffic if the first choice path is down

Routers can also:
* filter broadcast transmissions
* act as a simple firewall
* support local and remote connectivity
* provide high network fault tolerance
* monitor and report network traffic
* diagnose internal connectivity problems

Router categories:
* Core routers: located inside networks within the same autonomous system (group of networks operated by the same organization)
* Edge routers: connect an autonomous system with an outside network
* Exterior router: outside the autonomous system

### Multilayer Switches

Layer 3 switch: capable of interpreting layer 3 data, works like a router

Layer 4 switch: interprets layer 4 data, operate between layer 4 and layer 7; perform advanced filtering, keep statistics, and provide security

Both can work the same way???

### Routing Tables

Database that holds information about where hosts are located and the most efficient way to reach them

Router's network ports connect to different networks, each network connection is assigned an interface ID, the router belongs to every network it connects to

Routing table identifies which network a host belongs to, and the best next hop to get there

### Routing Path Types 

Static Routing: configured by a network administrator, directs messages along specific paths in a network; can't account for network issues (congestion, moved devices, failed connections)

Dynamic routing: router automatically calculates the best path between two networks, this information goes in the routing table; can reroute if there are network issues

### Route Command

Allows you to view the host's routing table, command line tool

Workstations have relatively small routing tables, internet backbone routers may have hundreds of thousands of entries

### Routing Metrics

Finding the best path to take

May use: 
* Hop counts
* Bandwidth
* Latency (delay) on a path
* Load
* MTU
* Routing cost
* Reliability
* Network topology

### Determining Best Path

Routers communicate through routing protocols to determine the best path

Reliability and priority of routing protocol data is based on:
* Administrative distance: number indicating reliability, assigned by default; can be changed by a network administrator
* Convergence time: time it takes to recognize a best path in the even of a network change
* Overhead: burden placed on underlying network to support the protocol

### Interior and Exterior Gateway Protocols

Interior Gateway Protocols: routing protocols used by interior routers and edge routers within autonomous systems

* Distance vector: calculate the best path to a destination on the basis of the distance to that destination; some use only the number of hops to a destination, others take network traffic into consideration
* Link-state: routers communicate beyond neighboring routers, then independently map the network and determine the best path between itself and the destination node; adapt more quickly to network changes

Exterior Gateway Protocols: used by edge routers and exterior routers

* Routing Information Protocol: **outdated** distance vector protocol; simple and stable; limited metrics, excessive overload, poor convergence time, limited network sze, slower and less secure

* Open Shortest Path First: supports large networks, uses complex algorithms to calculate more efficient test paths, shared data, low overhead and fast convergence, stable, supported by all modern routers

* Intermediate System to Intermediate System: similar to OSPF, but for core routers only

* Enhanced Interior Gateway Routing Protocol: distance vector protocol that also includes some of the features of link state; optimized for Cisco routers but available to all

* Border Gateway Protocol: **only current protocol** spans multiple autonomous systems and is used by edge and exterior routers on the internet; uses path-vector routing protocol, efficient, and customizable

### Troubleshooting

netstat: displays TCP/IP statistics (port where TCP/IP is running, network connections currently established, how many messages have been handled since a network interface was activated, how many data errors have occurred on a network interface)

tracert/traceroute: uses ICMP echo requests to trace the path from one networked node to another

pathping: sends pings to each hop along a route

tcpdump: packet sniffer, captures traffic that crosses a computer's network interface

Duplicate MAC addresses (rare, but happens; fixable by updating device configuration)
Hardware failures: use tracert or traceroute to track down problematic routers, use ping to test network connectivity
Neighbor discovery: managed by the ARP, can be fixed by flushing the ARP table on a device experiencing issues

***

Quiz

4. Which protocol's header would a layer 4 device read and process? TCP

Which routing protocol does an exterior router use to collect data to build its routing tables? BGP